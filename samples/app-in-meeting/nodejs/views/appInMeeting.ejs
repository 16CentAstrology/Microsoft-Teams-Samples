<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>App in a meeting demo</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://statics.teams.cdn.office.net/sdk/v1.10.0/js/MicrosoftTeams.min.js"
    integrity="sha384-6oUzHUqESdbT3hNPDDZUa/OunUj5SoxuMXNek1Dwe6AmChzqc6EJhjVrJ93DY/Bv"
    crossorigin="anonymous"></script>
  <script src="https://cdn.socket.io/socket.io-3.0.1.min.js"></script>
</head>

<body id=mainDiv>
  <div id="chatSection" className="chatSection">
    Sprint 80
    <div id="boardDiv" class="chat-window">
      <div id="todo">
        To Do
      </div>
      <div id="doing">
        Doing
      </div>
      <div id="done">
        Done
      </div>
    </div>

    <form class="chat-form" onsubmit="return false;">
      <label class="chat-label">
        Assigned To:
        <input type="text" class="user-name" />
      </label>
      <label class="chat-label">
        Description:
        <input type="text" class="task-description" />
      </label>
      <label class="chat-label">
        Task status:
        <select class="task-status">
          <option selected>todo</option>
          <option>doing</option>
          <option>done</option>
        </select>
      </label>
      <button class="send-button" id="updateDetails" onclick="sendTaskDetails()">Update Details</button>
    </form>
  </div>
  <script>
    var screenWidth = window.innerWidth;
    var meetingId;
    var userName;
    
    $(document).ready(function () {
      microsoftTeams.initialize();
      microsoftTeams.getContext(function (context) {
        meetingId = context.meetingId;
        tenantId = context.tid;
      })
      var chatSection = document.getElementById("chatSection");

      if (screenWidth > 600) {
        chatSection.className = "chatSectionStage"
        $("#todo, #doing, #done").addClass("grid-item");
        $("#todo, #doing, #done").removeClass("grid-item-sidepanel");
        $("#boardDiv").addClass("chat-window");
        $("#boardDiv").removeClass("chat-window-sidepanel");
      }
      else {
        chatSection.className = "chatSectionSidePanel";
        $("#todo, #doing, #done").addClass("grid-item-sidepanel");
        $("#todo, #doing, #done").removeClass("grid-item");
        $("#boardDiv").addClass("chat-window-sidepanel");
        $("#boardDiv").removeClass("chat-window");
      }
    });

    const socket = io();
    socket.on('connection')

    // Render details
    const renderDetails = (data) => {
      if (data.taskStatus == "todo") {
        $('#todo').append(`<div class="details">
        Assigned to: ${data.userName}</br>
        Task Description: ${data.taskDescription}</br>
        Status: ${data.taskStatus}</br>
        </div>
  `)
      }
      else if (data.taskStatus == "doing") {
        $('#doing').append(`<div class="details">
        Assigned to: ${data.userName}</br>
        Task Description: ${data.taskDescription}</br>
        Status: ${data.taskStatus}</br>
        </div>
  `)
      }
      else {
        $('#done').append(`<div class="details">
        Assigned to: ${data.userName}</br>
        Task Description: ${data.taskDescription}</br>
        Status: ${data.taskStatus}</br>
        </div>
  `)
      }
    }

    socket.on('message', (data) => {
      renderDetails(data)
    })

    // Send task details.
    const sendTaskDetails = () => {
      var taskStatus = document.querySelector(".task-status");
      var taskDescription = document.querySelector(".task-description")
      var userName = document.querySelector(".user-name")
      var isValid = true;
      $('.task-status,.task-description,.user-name').each(function (e) {
        if ($.trim($(this).val()) == '') {
          isValid = false;
          $(this).css({
            "border": "1px solid red"
          });
        }
        else {
          $(this).css({
            "border": "",
            "background": ""
          });
        }
      });
      if (isValid == false) {
        e.preventDefault();
        return false;
      }
      const taskDetails = {
        "taskStatus": taskStatus.value,
        "taskDescription": taskDescription.value,
        "userName": userName.value
      };
      socket.emit('message', taskDetails);
    }
  </script>
</body>

</html>