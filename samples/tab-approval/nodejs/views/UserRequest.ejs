<!DOCTYPE html>
<html lang="en">

<head>

    <head>
        <script src="https://unpkg.com/@microsoft/teams-js/dist/MicrosoftTeams.min.js" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/@microsoft/mgt/dist/bundle/mgt-loader.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://statics.teams.cdn.office.net/sdk/v1.6.0/js/MicrosoftTeams.min.js"
            integrity="sha384-mhp2E+BLMiZLe7rDIzj19WjgXJeI32NkPvrvvZBrMi5IvWup/1NUfS5xuYN5S3VT"
            crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <script src="./scripts/auth-delegated.js"></script>
        <meta charset="UTF-8">
        <meta http-equiv="Content-Security-Policy"
            content="default-src *; style-src 'self' 'unsafe-inline' http://localhost:3978; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
    </head>
    <style>
        #mainDiv {
            padding-left: 2%;
            padding-top: 2%;
            padding-right: 2%;
        }
    </style>
</head>

<body id=mainDiv>
    <div>
        <div id="productDetails">
            <h4>Request Details</h4>
            <br>
            Request Name: <label id="requestName"></label>
            <br />
            Request Description: <label id="requestDescription"></label>
            <br />
            Created By: <label id="requestCreatedBy"></label>
            <br />
        </div>
        <label id="noRequestFound">
        </label>
        <br/>
        <button type="button" class="btn btn-outline-info" id="btnApprove" onclick="ApproveRequest()">Approve</button>
        <button type="button" class="btn btn-outline-info" id="btnReject" onclick="RejectRequest()">Reject</button>
    </div>
    <script>
          var data =  <%-data%>
        microsoftTeams.initialize(()=>{
            getRequestDetails(); 
        })
        // Method to show geo location for given latitude and longitude values.
        function getRequestDetails() {
            if(data != null){
                $("#requestName").text(data.title);
                $("#requestDescription").text(data.description);
                $("#requestCreatedBy").text(data.createdBy);
            }
        }

        function ApproveRequest() {
            var taskId = data.id;
            let taskInfo = {
                taskId: taskId,
                status: "Approved"
            };
            $.ajax({
                type: 'POST',
                url: '/ApproveRejectRequest',
                contentType: 'application/json',
                data: JSON.stringify(taskInfo),
                success: function (data, textStatus, jQxhr) {
                    microsoftTeams.tasks.submitTask(true);
                },
                error: function (jqXhr, textStatus, errorThrown) {
                    console.log('error', errorThrown);
                }
            });

            microsoftTeams.tasks.submitTask(true);
        };  

        function RejectRequest() {
            var taskId = data.id;
            let taskInfo = {
                taskId: taskId,
                status: "Rejected"
            };

            $.ajax({
                type: 'POST',
                url: '/ApproveRejectRequest',
                contentType: 'application/json',
                data: JSON.stringify(taskInfo),
                success: function (data, textStatus, jQxhr) {
                    microsoftTeams.tasks.submitTask(true);
                },
                error: function (jqXhr, textStatus, errorThrown) {
                    console.log('error', errorThrown);
                }
            });

            microsoftTeams.tasks.submitTask(true);
        };
    </script>
</body>

</html>